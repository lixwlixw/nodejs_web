<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>基本信息_DataHub阳光下的数据流通平台 </title>
<link rel="stylesheet" href="css/bootstrap.min.css">
<link rel="stylesheet" href="css/command.css">
<link rel="stylesheet" href="css/loader.css">
<link rel="stylesheet" href="css/animate.css">
<link rel="stylesheet" href="css/selects.css">
<link rel="stylesheet" href="css/basicInfo.css">

</head>

<style>
	.nav > li > a:hover{
		background-color:rgba(31,154,218,0.7); 
	}	
	.navbar-toggle .icon-bar {
	    background-color: #fff;
	}
	.navbar-nav > li > a:focus{
		background:none;
	}
</style>

<body>


<div class="be-loader" style="display: block;">
    <div class="spinner">
        <div class="spinner-container container1">
            <div class="circle1"></div>
            <div class="circle2"></div>
            <div class="circle3"></div>
            <div class="circle4"></div>
        </div>
        <div class="spinner-container container2">
            <div class="circle1"></div>
            <div class="circle2"></div>
            <div class="circle3"></div>
            <div class="circle4"></div>
        </div>
        <div class="spinner-container container3">
            <div class="circle1"></div>
            <div class="circle2"></div>
            <div class="circle3"></div>
            <div class="circle4"></div>
        </div>
    </div>
</div>
	
	
	<!-- 头部导航 -->
	<header></header>
	
	<!-- 内容页 -->
	<div  class="container main">
	
	<div class="topBox">
		<div style="float:left;margin-top:30px;width:950px;">
		<div  class="top_title">
			<p>账户信息</p>
			
		</div>
		<div  class="top_main">
			<div class="form-group" style="margin-bottom: 15px">
				<label for="exampleInputEmail1">注册邮箱</label>
				<input type="email" class="form-control " id="exampleInputEmail1" placeholder="注册邮箱"
					    style="margin-bottom: 0px;width:480px;">
			</div>
			<div class="form-group">
				<label for="exampleInputTime">注册时间</label>
				<input type="text" class="form-control" id="exampleInputTime" placeholder="注册时间">
			</div>
			<div class="form-group">
				<label for="exampleInputMember">会员级别</label>
				<input type="text" class="form-control" id="exampleInputMember" placeholder="会员级别" disabled="disabled">
			</div>
			<div class="form-group">
				<label for="exampleInputTime">截止时间</label>
				<input type="text" class="form-control" id="exampleStopTime" placeholder="截止时间">
			</div>
		</div>
		</div>
			
	</div>
	<div class="midBox">
		<div style="float:left;margin-top:30px;width:950px;">
		<div  class="mid_title">
			<p>基本信息</p>
		</div>
        <div id="mid_alert" >
                <p id="success">修改成功！</p>
                <p id="error">提交失败！</p>
				<p id="error_emptyName">名称不能为空</p>
				<p id="error_emptyComment">简介不能为空</p>
				<p id="error_allEmpty">名称和简介不能为空</p>
			<!--做到这-->
        </div>
		<div  class="mid_main">

			<div id="update_icon">
				<span class="span_icon"></span>
			</div>
			<div class="form-group">
				<label for="exampleInputName">名称<span>设置后不能修改</span></label>
				<input type="email" class="form-control " id="exampleInputName" placeholder="企业名称/个人名称"
                         style="margin-bottom: 0;width:480px;">
			</div>
			<div class="form-group">
				<label for="exampleInputTime">简介</label>
				<textarea id="textComment" class="form-control form-control-self" disabled=""  rows="6" placeholder="基本情况介绍，100字以内"maxlength="100" style="width:480px;"></textarea>
			</div>

			 <button type="submit" id="button01" class="btn btn-default">提交</button>
		</div>
		</div>
			
	</div>
	<div class="underBox">
		<div style="float:left;margin-top:30px;width:950px;">
				<div class="under_title">
					<p>资源状态</p>
				</div>
				
				<div  class="under_main">
					<div  class="p_progress">
						<p>Pull量：<span>2000次/天</span></p>
						<div class="progress">
						  <div id="pullNum" class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" >
							<span class="sr-only">40% Complete (success)</span>
						  </div>
						</div>
					</div>
					<div class="circle_group">

						<div class="circle">
							<div class="pie_left">
								<div class="left"></div>
							</div>
							<div class="pie_right">
								<div class="right"></div>
							</div>
							<div class="mask">
								<div >
									<p>已用</p>
									<p id="usePublic"></p>
								</div>
							</div>
							<p>开放Repository：<span></span></p>
						</div>

						<div class="circle1">
							<div class="pie_left1">
								<div class="left1"></div>
							</div>
							<div class="pie_right1">
								<div class="right1"></div>
							</div>
							<div class="mask1">
								<div >
									<p>已用</p>
									<p id="usePrivate"></p>
								</div>
							</div>
							<p>私有Repository：<span></span></p>
						</div>

						<div class="circle2">
							<div class="pie_left2">
								<div class="left2"></div>
							</div>
							<div class="pie_right2">
								<div class="right2"></div>
							</div>
							<div class="mask2">

									<p>已用</p>
									<p id="deposit"></p>

							</div>
							<p>托管空间：<span></span></p>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	


	<footer></footer>
	
	<div id="loginTem"></div>
	


</body>
<script src="js/jquery.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/jquery.cookie.js"></script>
<script src="js/ngUrl.js"></script>
<script src="js/login.js"></script>
<script src="js/base64.js"></script>
<script src="js/md5.js"></script>
<script src='js/errorDialog.js'></script>

<script>
$(document).ready(function(){
/*console.log(JSON.stringify($.cookie("token")));*/
		$('#exampleInputTime').attr('disabled', 'true');
		$('#exampleStopTime').attr('disabled', 'true');
		$.ajax({
			url:ngUrl+"/users/"+$.cookie("tname"),
			type:"get",
			cache:false,
			async:false,
			headers:{Authorization:"Token "+$.cookie("token")},
			datatype:'json',
				success:function(data){
					var nickName=data.data.nickName;
					var comment=data.data.comment;
//输入框有数据
                    if (nickName.length>0||comment.length>0)
                    {
						$("#exampleInputName").attr("disabled",true);
						$("#textComment").attr("disabled",false);
                        $("#exampleInputName").val(nickName);
                        $("#textComment").val(comment);
						$("#update_icon").css("display","none");
//                        $("#exampleInputName").attr("disabled","disabled");
//                        $("#textComment").attr("disabled","disabled");
//                        $("#button01").css("display","none");
                    }
					//输入框无数据
                    if (nickName.length==0||comment.length==0)
                    {
                        $("#exampleInputName").val(nickName);
                        $("#textComment").val(comment);
						$("#button01").css("display","block");
						$("#exampleInputName").attr("disabled",false);
						$("#textComment").attr("disabled",false);
						$("#update_icon").css("display","none");

                    }
				},
				error:function(){
					errorDialog($.parseJSON(json.responseText).code);
					$('#errorDM').modal('show');
				}
		});
		$("#update_icon").click(function(){
            $("#button01").css("display","block");
//            $("#exampleInputName").attr("disabled",false);//名称设置后不能修改
            $("#textComment").attr("disabled",false);
			$("#update_icon").css("display","none");


        });

		$.ajax({
			url:ngUrl+"/vip/"+$.cookie("tname"),
			type:"get",
			cache:false,
			async:false,
			headers:{Authorization:"Token "+$.cookie("token")},
			datatype:'json',
				success:function(data){
					var email=$.cookie("tname");
					$("#exampleInputEmail1").val(email);
					if (data.data.userType==1)
					{
						$("#exampleInputMember").val("注册用户");
					}	
					else if (data.data.userType==3)
					{
						$("#exampleInputMember").val("认证会员");
					}	
					else if (data.data.userType==4)
					{
						$("#exampleInputMember").val("金卡会员");
					}	
					else if (data.data.userType==5)
					{
						$("#exampleInputMember").val("钻石会员");
					}	
				},
				error:function(json){
					errorDialog($.parseJSON(json.responseText).code);
					$('#errorDM').modal('show');

				}
		});
});


$(document).ready(function(){
	$("#button01").click(function(){
		var mydata = {};
		mydata["nickname"] = $("#exampleInputName").val();
		mydata["comments"] = $("#textComment").val();
		if(($("#textComment").val().length==0)&&($("#exampleInputName").val().length==0))
		{
			$("#error_allEmpty").css("display","block");
			$("#error_emptyName").css("display","none");
			$("#error_emptyComment").css("display","none");
			$("#error_allEmpty").fadeOut(3500);
		}
		else if($("#textComment").val().length==0)
		{
			$("#error_emptyComment").css("display","block");
			$("#error_emptyName").css("display","none");
			$("#error_allEmpty").css("display","none");
			$("#error_emptyComment").fadeOut(3500);
		}
		else if($("#exampleInputName").val().length==0)
		{
			$("#error_emptyName").css("display","block");
			$("#error_emptyComment").css("display","none");
			$("#error_allEmpty").css("display","none");
			$("#error_emptyName").fadeOut(3500);
		}
		else{
			$.ajax({
				url:ngUrl+"/users/"+$.cookie("tname"),
				type:"PUT",
				cache:false,
				async:false,
				beforeSend:function(){
					$('#button01').attr('disabled','disabled');
					$('#button01').text('正在保存中');
				},
				complete:function(){
					$('#button01').removeAttr('disabled');
					$('#button01').text('提交');
				},

				headers:{Authorization:"Token "+$.cookie("token")},
				datatype:'json',
				data: JSON.stringify(mydata),

				success:function(data){
					if(data.code==0){

							$("#exampleInputName").attr("disabled","disabled");
							$("#textComment").attr("disabled","disabled");
							$("#button01").css("display","none");
							$("#update_icon").css("display","inline-block");
							$("#success").css("display","block");
							$("#error").css("display","none");
							$("#error_emptyName").css("display","none");
							$("#error_emptyComment").css("display","none");
							$("#error_allEmpty").css("display","none");
							$("#success").fadeOut(4000);


					}
				},
				error:function(data){
					if(data.code!=0){
						$("#error").css("display","block");
						$("#success").css("display","none");
						$("#error").fadeOut(4000);
					}
				}
			});
		}
	});
		
});
</script>
	

<script>

	$("a").focus(function(){this.blur()});
	$("header").load("common/header.html");
	$("footer").load("common/footer.html");
	$("#loginTem").load("common/login.html");
	
	var repos=[];
	
	$(window).load(function(){
		$(".be-loader").fadeOut("slow");
	});

</script>
<script>

//pull量
	$(document).ready(function(){
		$.ajax({
			url:ngUrl+"/quota/"+$.cookie("tname")+"/pullnum",
			type:"get",
			cache:false,
			async:false,
			headers:{Authorization:"Token "+$.cookie("token")},
			datatype:'json',
			success:function(data){
				var pullNumA=data.data.use;
				var pullNumB=(pullNumA/2000).toFixed(4);
				var pullNumC=pullNumB.slice(2,4)+"."+pullNumB.slice(4,6)+"%";
				$("#pullNum").css("width","pullNumC");
			},
			error:function(){
                errorDialog($.parseJSON(json.responseText).code);
                $('#errorDM').modal('show');
			}
		})

/*		$.ajax({
			url:ngUrl+"/vip/"+$.cookie("tname"),
			type:"get",
			cache:false,
			async:false,
			headers:{Authorization:"Token "+$.cookie("token")},
			datatype:'json',
			success:function(data){
				$(".circle p span").text(data.data.repoPub+"个");
				$(".circle1 p span").text(data.data.repoPri+"个");
				$(".circle2 p span").text(data.data.deposit);
			},
			error:function(){
			}
		})*/
//repo配额
		$.ajax({
			url:ngUrl+"/quota/"+$.cookie("tname")+"/repository",
			type:"get",
			cache:false,
			async:false,
			headers:{Authorization:"Token "+$.cookie("token")},
			datatype:'json',
			success:function(data){
                var usePublic=parseFloat(data.data.usePublic);
                var usePrivate=parseFloat(data.data.usePrivate);
                var quotaPublic=parseFloat(data.data.quotaPublic);
                var quotaPrivate=parseFloat(data.data.quotaPrivate);

				$("#usePublic").text(usePublic);
				$("#usePrivate").text(usePrivate);
				$(".circle p span").text(quotaPublic+"个");
				$(".circle1 p span").text(quotaPrivate+"个");
//第一个圆环
                var uqc=parseFloat(usePublic/quotaPublic);
                if(uqc==0){
                    $(".left").css("transform", "rotate()");
                    $(".right").css("transform", "rotate()");
                }
                if (uqc <= 0.5&&uqc>0) {
                    var leftNum = uqc * 360;
                    $(".left").css("transform", "rotate(-"+leftNum+"deg)");
                }
                if (uqc > 0.5) {
                    var rightNum = (uqc - 0.5) * 360;
                    $(".left").css("transform", "rotate(-180deg)");
                    $(".right").css("transform", "rotate(-" + rightNum + "deg)");
                }
//第二个圆环
                if(quotaPrivate==0)
                {
                    $(".left1").css("transform", "rotate(deg)");
                    $(".right1").css("transform", "rotate(deg)");
                }
                if(quotaPrivate!=0)
                {
                    var uqe=usePrivate/quotaPrivate;
                    if (uqe <= 0.5) {
                        var leftNum2 = uqe * 360;
                        $(".left1").css("transform", "rotate(-" + leftNum2 + "deg)");

                    }
                    if (uqe > 0.5) {
                        var rightNum2 = (uqe - 0.5) * 360;
                        $(".left1").css("transform", "rotate(-180deg)");
                        $(".right1").css("transform", "rotate(-" + rightNum2 + "deg)");
                    }
                }
			},
			error:function(){
			}
		})
//托管空间
		$.ajax({
			url:ngUrl+"/quota/"+$.cookie("tname")+"/deposit",
			type:"get",
			cache:false,
			async:false,
			headers:{Authorization:"Token "+$.cookie("token")},
			datatype:'json',
			success:function(data) {
                var use1 = data.data.use;//使用配额
                var quota1 = data.data.quota;//托管配额
                var use = use1.substring(0, (use1.length - 1));
                var quota = quota1.substring(0, (quota1.length - 1));
                uq = (use / quota).toFixed(2);
                $("#deposit").text(use1);
                $(".circle2 p span").text(quota1);
                if(uq==0)
                {
                    $(".left2").css("transform", "rotate(deg)");
                    $(".right2").css("transform", "rotate(deg)");
                }
                if (0<uq <= 0.5) {
                    var leftNum = uq * 360;
                    $(".left2").css("transform", "rotate(-" + leftNum + "deg)");
                }
                if (uq > 0.5) {
                    var rightNum = (uq - 0.5) * 360;
                    $(".left2").css("transform", "rotate(-180deg)");
                    $(".right2").css("transform", "rotate(-" + rightNum + "deg)");
                }
            },
				error:function(){
                    errorDialog($.parseJSON(json.responseText).code);
                    $('#errorDM').modal('show');

				}


	    });

    });

</script>